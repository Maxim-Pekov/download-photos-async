![Typing SVG](https://readme-typing-svg.herokuapp.com?color=%2336BCF7&lines=Микросервис+для+скачивания+файлов)

Микросервис помогает работе основного сайта, сделанного на CMS и обслуживает
запросы на скачивание архивов с файлами. Микросервис не умеет ничего, кроме упаковки файлов
в архив. Закачиваются файлы на сервер через FTP или админку CMS.

Создание архива происходит на лету по запросу от пользователя. Архив не сохраняется на диске, вместо этого по мере упаковки он сразу отправляется пользователю на скачивание.

От неавторизованного доступа архив защищен хешом в адресе ссылки на скачивание, например: `http://host.ru/archive/3bea29ccabbbf64bdebcc055319c5745/`. Хеш задается названием каталога с файлами, выглядит структура каталога так:

```
- photos
    - 3bea29ccabbbf64bdebcc055319c5745
      - 1.jpg
      - 2.jpg
      - 3.jpg
    - af1ad8c76fda2e48ea9aed2937e972ea
      - 1.jpg
      - 2.jpg
```


## Как установить

Для работы микросервиса нужен Python версии не ниже 3.6.

1. Установить

```python
git clone https://github.com/Maxim-Pekov/download-photos-async.git
```

2. Создайте виртуальное окружение:

```python
python - m venv venv
```

3. Активируйте виртуальное окружение:

```python
.\venv\Scripts\activate`  # for Windows
```

```python
source ./.venv/bin/activate  # for Linux
```

4. Перейдите в `download-photos-async` директорию.

3. Установите зависимости командой ниже:

```python
pip install - r requirements.txt
```

4. Запустите сайт командой:

```python
python3 server.py
```

## Как установить с помошью Docker:

1. После скачивания репозитория установите докер по инструкции:

```python
https://github.com/docker/cli
```

2. Перейдите в `download-photos-async` директорию.
3. Выполните команду по сборке докер контейнера:

```python
sudo docker-compose up --build
```

Сервер запустится на порту 8000, чтобы проверить его работу перейдите в браузере на страницу [http://127.0.0.1:8080/](http://127.0.0.1:8080/).

## Дополнительные настройки скрипта:

1. При добавлении флага `'-l' или '--is_logging'` включится логирование
```python
python3 server.py -l
```
2. При добавлении флага `'-d' или '--download_delay'` включится задержка при скачивании 
```python
python3 server.py -d
```
3. При добавлении флага `'-f <-your folder->' или '--photo_folder <-your folder->'` изменяет расположение папки с фотографиями на сайте
```python
python3 server.py -f
```
4. Флаги можно комбинировать

```python
python server.py -l -d -f 'my_folder'
```

## Если хотите добавить дополнительные настройки при запуске контейнера то 

перед запуском отредактируйте docker-compose.yml в строчке номер 12, 
после команды `python server.py` можно добавить теже флаги.
